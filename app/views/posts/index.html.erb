<h2>投稿一覧</h2>
<div id="map"></div>

<script>
  let map
    
    function initMap(){
      geocoder = new google.maps.Geocoder()
      
      map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 35.68123620000001, lng:139.7671248},
          zoom: 5,
      });
      
      <% @posts.each do |post| %>
        (function(){
          let contentString = "<%= post.address %>"; 
          let infowindow = new google.maps.InfoWindow({
            // function infoWindow(name, address, latitude, longitude, contentString) {
            //   return new google.maps.InfoWindow({ // 吹き出しの追加
            // content: `<a href='/users/post.id'>'+ address +'</a>` // 吹き出しに表示する内容
            content: contentString
          });
          
          let marker = new google.maps.Marker({
              position:{lat: <%= post.latitude %>, lng: <%= post.longitude %>},
              map: map,
              title: contentString
          });
          marker.addListener('click', function() {
           infowindow.open(map, marker);
         });
        })();
      <% end %>
      }
</script>