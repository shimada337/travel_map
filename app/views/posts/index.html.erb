<h2>投稿一覧</h2>
<!--<input id="address" type="textbox" placeholder="住所を入れて付近を見る">-->
<!--<input type="button" value="検索する" onclick="codeAddress()">-->

投稿数<%= @posts.count %>
<div id="map"></div>

<script>
  let map
  let geocoder
    
  function initMap(){
    geocoder = new google.maps.Geocoder()
    
    map = new google.maps.Map(document.getElementById('map'), {
        center: {lat: 35.68123620000001, lng: 139.7671248},
        zoom: 5,
    });
    
    
    <% @posts.each do |post| %>
      (function(){
        let contentString = "<a href='/posts/<%= post.id %>'><%= post.address %></a>"; 
        let infowindow = new google.maps.InfoWindow({
          content: contentString
        });
        
        let marker = new google.maps.Marker({
            position:{lat: <%= post.latitude %>, lng: <%= post.longitude %>},
            map: map,
            title: contentString
        });
        
        marker.addListener('click', function() {
         infowindow.open(map, marker);
       });
      })();
    <% end %>
  }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['API_KEY'] %>&callback=initMap" async defer></script>